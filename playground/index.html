<html ng-app>
<head>
  <meta charset="utf-8">
  <title>Bongo.js Playground</title>
  <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
  <script type="text/javascript" src="../src/bongo.es5.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
</head>
<body>
  <div class="container" style="margin-top: 24px;">
    <h1>Bongo.js Playground</h1>
  </div>
  <div ng-controller="AppController">
    <textarea rows="5" ng-model="query" class="input-block-level"></textarea>
    <button class="btn btn-large btn-primary" ng-click="runQuery(query)" style="margin-bottom: 24px;">Run</button>
    <table class="table table-striped table-condensed">
      <thead>
        <tr>
          <th>Name</th>
          <!-- th>Active</th -->
          <th>Age</th>
          <th>Points</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="player in players | limitTo:100">
          <td>{{player.name}}</td>
          <!-- td>{{player.active}}</td -->
          <td>{{player.age}}</td>
          <td>{{player.points}}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <script>
    var schema = {
      name: 'playground',
      objectStores: {
        players: ['age','points']
      }
    };
    db = bongo.db(schema,function() {
      bongo.playground.players.remove({},function(error,results) {});
    });

    var update;

    function AppController($scope) {
      $scope.players = [];
      $scope.query = "bongo.playground.players.find({\n  name: /donald/i,\n  age: 32\n}).limit(100).toArray(update)";
      $.getJSON('../mock.json',function(data) { 
        data.players.forEach(function(player) {
          bongo.playground.players.save(player);
        });
        $scope.players = data.players;
        $scope.$apply('players');
      })

      update = function(error,results) {
        console.clear();
        console.log('results',results);
        $scope.players = results;
        $scope.$apply('players');
      }

      $scope.runQuery = function(query) {
        eval(query);
      }
    }
  </script>
</body>
</html>
